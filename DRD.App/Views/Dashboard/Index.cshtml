@model DRD.Models.View.Layout

@{
    ViewBag.Title = "Dashboard";
    ViewBag.Submenu = "DASHBOARD";
}

@section Scripts
{
    <script src="/assets/js/plugins/buttons/spin.min.js" type="text/javascript"></script>
    <script src="/assets/js/plugins/buttons/ladda.min.js" type="text/javascript"></script>
    <script src="/assets/js/pages/components_buttons.js" type="text/javascript"></script>

    <script src="/assets/vendors/angular-1.5.5/angular.js"></script>
    <script src="/assets/vendors/angular-1.5.5/angular-animate.js"></script>
    <script src="/Scripts/ui-bootstrap-tpls-1.3.2.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>

    <!-- Theme JS files -->
    <script type="text/javascript" src="assets/js/plugins/forms/styling/uniform.min.js"></script>
    <script type="text/javascript" src="assets/js/plugins/visualization/d3/d3.min.js"></script>
    <script type="text/javascript" src="assets/js/plugins/visualization/d3/d3_tooltip.js"></script>
    <!-- /theme JS files -->
 }
@section Styles{ 
    <link href="/assets/css/pages/dashboard.css" rel="stylesheet" type="text/css">
}
    <body ng-controller="drdController">
        <div class="page-container">
            <section id="dashboard-highlight">
                <div class="row">

                    <!-- DASHBOARD - ROTATION -->
                    <div class="col-sm-12 col-md-6" id="dashboard-rotation">
                        <div class="panel highlight-container">
                            <div class="highlight-card">
                                <!-- HEADER -->
                                <div class="highlight-header">
                                    <div class="container">
                                        <div class="row vertical-align-row">
                                            <div class="col-md-6">
                                                <p class="card-title"><strong>ROTATION</strong></p>
                                            </div>
                                            <div class="col-md-3 push-left">
                                                <!-- SELECT -->
                                                <select class="card-filter">
                                                    <option class="card-filter" ng-repeat="x in companyOwned">{{x.Name}}</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- CONTENT -->
                                <div class="card-content">
                                    <div class="container">
                                        <div class="row">
                                            <div class="col-sm-6">
                                                <div class="row vertical-align-row" ng-click="linkPage('INPROGRESS')">
                                                    <div class="col-sm-6 vertical-align-content">
                                                        <div class="card-image-lg round-img">
                                                            <img src="~/assets/ongoing.png" />
                                                            <p>Ongoing</p>
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-6">
                                                        <div class="card-content-lg">
                                                            <h1>{{counter.New.InProgress}}</h1>
                                                        </div>

                                                    </div>

                                                </div>
                                            </div>

                                            <div class="col-sm-6">
                                                <div class="row vertical-align-row" ng-click="linkPage('COMPLETED')">
                                                    <div class="col-sm-6 vertical-align-content">
                                                        <div class="card-image-lg round-img">
                                                            <img src="~/assets/completed.png" />
                                                            <p>Completed</p>
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-6">
                                                        <div class="card-content-lg">
                                                            <h1>{{counter.New.Completed}}</h1>
                                                        </div>

                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- end of DASHBOARD - ROTATION -->
                    <!-- DASHBOARD - USAGE-->
                    <div class="col-sm-12 col-md-6" id="dashboard-usage">
                        <div class="panel highlight-container">
                            <div class="highlight-card">

                                <!-- HEADER -->
                                <div class="highlight-header">
                                    <div class="container">
                                        <div class="row vertical-align-row">
                                            <div class="col-md-6">
                                                <p class="card-title"><strong>USAGE</strong></p>
                                            </div>
                                            <div class="col-md-3 push-left">
                                                <!-- SELECT -->
                                                <select class="card-filter">
                                                    <option class="card-filter" ng-repeat="x in companyOwned">{{x.Name}}</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- CONTENT -->
                                <div class="card-content">
                                    <div class="container">
                                        <div class="row vertical-align-row">
                                            <div class="col-sm-5 vertical-align-content">

                                                <canvas id="myChart" width="100" height="100"></canvas>

                                            </div>

                                            <div class="col-sm-5 vertical-align-content">
                                                <div class="card-image-lg">
                                                    <canvas id="otherPie" width="100" height="100"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- end of DASHBOARD - USAGE-->

                </div>
            </section>

            <section id="dashboard-rotation-status" ng-init="getDashboardRotationStatus">
                <div class="panel highlight-container">
                    <div class="highlight-card">
                        <!-- HEADER -->
                        <div class="highlight-header">
                            <div class="container">
                                <div class="row">
                                    <div class="col-sm-12">
                                        <label class="control-label">Tags Filter</label>
                                    </div>
                                    <div class="col-sm-12">
                                        <form>
                                            <input type="text" class="form-control" ng-model="$parent.newTag" ng-keyup="($event.keyCode == 188 || $event.keyCode == 13) && addTagList()" />
                                            <div style="color:black;font-size:10px;align-self:end">use coma to use the tag you type</div>
                                        </form>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <span class="tag-item" ng-repeat="tag in tags">
                                            {{tag}}
                                            <button class="image-container-sm red-border" ng-click="($event.keyCode != 13) && removeTag($index)">
                                                <img src="~/Images/icon/reject.png" />
                                            </button>
                                        </span>
                                    </div>
                                </div>
                                <div class="row vertical-align-row">
                                    <div class="col-md-1">
                                        <button class="image-container-sm" ng-click="exportRotationListToCSV()">
                                            <span class="tooltiptext">export as csv</span>
                                            <img src="~/Images/icon/export-csv.png"/>
                                        </button>
                                    </div>
                                    <div class="col-md-7">
                                        <p class="card-title"><strong>Rotation Status</strong></p>
                                    </div>
                                    <div class="col-md-4 push-left">
                                        <!-- SELECT -->
                                        <select class="card-filter select-lg">
                                            <option class="card-filter" ng-repeat="x in companyOwned">{{x.Name}}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- CONTENT -->
                        <div class="card-content" ng-show="listrotationStatus.Count() > 0" >
                            <!-- each rotation status -->
                            <div class="container">
                                <table class="table-xxs table-borderless table-hover datatable-highlight dataTable no-footer" style="font-size:small;width:100%">
                                    <thead>
                                        <tr>
                                            <th style="width: 14%">Workflow Name</th>
                                            <th style="width: 14%">Name</th>
                                            <th style="width: 7%">Status</th>
                                            <th style="width: 7%">Created</th>
                                            <th style="width: 7%">Updated</th>
                                            <th style="width: 44%">Position Now</th>
                                            <th style="width: 7%">Send Email</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr style="cursor:pointer;height:50px;vertical-align:central;" ng-repeat="x in listrotationStatus">
                                            <td>{{x.Workflow.Name}}</td>
                                            <td>{{x.Subject}}</td>
                                            <td>{{x.Status}}</td>
                                            <td><span style="font-size:xx-small;color:darkblue">{{convertJsonDate(x.DateCreated) | date: 'dd/MM/yyyy HH:mm:ss'}}</span></td>
                                            <td><span style="font-size:xx-small;color:darkblue">{{convertJsonDate(x.DateUpdated) | date: 'dd/MM/yyyy HH:mm:ss'}}</span></td>
                                            <td>
                                                <span ng-repeat="usr in x.RotationUsers"><img src="/Images/Member/{{usr.EncryptedId}}/{{usr.ImageProfile}}" /></span>
                                            </td>
                                            <td><button ng-click="sendEmailNotifikasiRotasi($index)">Notify Latest Person</button></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="pagination-container">
                                <div class="pagination">
                                    <a ng-click="backRotationStat()">&laquo;</a>
                                    <a href="#" class="active">{{ pagerotationstatus }}</a>
                                    <a ng-click="nextRotationStat()">&raquo;</a>
                                </div>
                                <p class="pagination-info">{{ pagerotationstatus }}</p>

                            </div>
                        </div>

                    </div>
                </div>

            </section>
            <section id="dashboard-log">

                <div class="panel highlight-container">
                    <div class="highlight-card">
                        <!-- HEADER -->
                        <div class="highlight-header">
                            <div class="container">
                                <div class="row vertical-align-row">
                                    <div class="col-md-8">
                                        <p class="card-title"><strong>LOG</strong></p>
                                    </div>
                                    <div class="col-md-4 push-left">
                                        <!-- SELECT -->
                                        <select class="card-filter select-lg">
                                            <option class="card-filter" ng-repeat="x in companyOwned">{{x.Name}}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- CONTENT -->
                        <div class="card-content">
                            <!-- each LOG -->
                            <div class="log container">

                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <div class="card-image">
                                                    <img src="~/assets/ongoing-no-bg.png" />
                                                </div>
                                            </div>
                                            <div class="col-md-9">
                                                <div class="row log-header">
                                                    <span class="border-right">
                                                        <strong>XCD/II/2019</strong>
                                                    </span>
                                                    <span>
                                                        Workflow Apagitu
                                                    </span>
                                                </div>

                                                <p>Permintaan Persetujuan</p>

                                            </div>
                                        </div>

                                    </div>

                                    <div class="col-md-2 text-align-right border-right">
                                        <i>Important Note (Nominal, Due Date, etx.)</i>
                                    </div>
                                    <div class="col-md-4">
                                        <p class="text-light">
                                            Deskripsi...
                                        </p>
                                    </div>
                                    <div class="col-md-2">
                                        <p class="text-align-right"><strong>04.09 PM</strong></p>
                                        <div class="row pull-right">
                                            <span class="card-image-xs round-img">
                                                <img src="~/assets/ongoing-no-bg.png" />
                                            </span>

                                            <span class="card-image-xs round-img">
                                                <img src="~/assets/ongoing-no-bg.png" />
                                            </span>

                                            <span class="card-image-xs round-img">
                                                <img src="~/assets/ongoing-no-bg.png" />
                                            </span>

                                            <span class="card-image-xs round-img">
                                                <img src="~/assets/ongoing-no-bg.png" />
                                            </span>
                                        </div>
                                    </div>
                                </div>


                            </div>

                            <div class="log container">

                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <div class="card-image">
                                                    <img src="~/assets/ongoing-no-bg.png" />
                                                </div>
                                            </div>
                                            <div class="col-md-9">
                                                <div class="row log-header">
                                                    <span class="border-right">
                                                        <strong>XCD/II/2019</strong>
                                                    </span>
                                                    <span>
                                                        Workflow Apagitu
                                                    </span>
                                                </div>

                                                <p>Permintaan Persetujuan</p>

                                            </div>
                                        </div>

                                    </div>

                                    <div class="col-md-2 text-align-right border-right">
                                        <i>Important Note (Nominal, Due Date, etx.)</i>
                                    </div>
                                    <div class="col-md-4">
                                        <p class="text-light">
                                            Deskripsi...
                                        </p>
                                    </div>
                                    <div class="col-md-2">
                                        <p class="text-align-right"><strong>04.09 PM</strong></p>
                                        <div class="row pull-right">
                                            <span class="card-image-xs round-img">
                                                <img src="~/assets/ongoing-no-bg.png" />
                                            </span>

                                            <span class="card-image-xs round-img">
                                                <img src="~/assets/ongoing-no-bg.png" />
                                            </span>

                                            <span class="card-image-xs round-img">
                                                <img src="~/assets/ongoing-no-bg.png" />
                                            </span>

                                            <span class="card-image-xs round-img">
                                                <img src="~/assets/ongoing-no-bg.png" />
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="log container">

                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <div class="card-image">
                                                    <img src="~/assets/ongoing-no-bg.png" />
                                                </div>
                                            </div>
                                            <div class="col-md-9">
                                                <div class="row log-header">
                                                    <span class="border-right">
                                                        <strong>XCD/II/2019</strong>
                                                    </span>
                                                    <span>
                                                        Workflow Apagitu
                                                    </span>
                                                </div>

                                                <p>Permintaan Persetujuan</p>

                                            </div>
                                        </div>

                                    </div>

                                    <div class="col-md-2 text-align-right border-right">
                                        <i>Important Note (Nominal, Due Date, etx.)</i>
                                    </div>
                                    <div class="col-md-4">
                                        <p class="text-light">
                                            Deskripsi...
                                        </p>
                                    </div>
                                    <div class="col-md-2">
                                        <p class="text-align-right"><strong>04.09 PM</strong></p>
                                        <div class="row pull-right">
                                            <span class="card-image-xs round-img">
                                                <img src="~/assets/ongoing-no-bg.png" />
                                            </span>

                                            <span class="card-image-xs round-img">
                                                <img src="~/assets/ongoing-no-bg.png" />
                                            </span>

                                            <span class="card-image-xs round-img">
                                                <img src="~/assets/ongoing-no-bg.png" />
                                            </span>

                                            <span class="card-image-xs round-img">
                                                <img src="~/assets/ongoing-no-bg.png" />
                                            </span>
                                        </div>
                                    </div>
                                </div>


                            </div>

                        </div>
                    </div>
                </div>

            </section>
        </div>

        <script>
            var ctx = document.getElementById('myChart');
            var data = {
                datasets: [{
                    data: [13, 87],
                    backgroundColor: [
                        'rgba(153, 165, 255, 1)',
                        'rgba(54, 162, 235, 0.2)'
                    ]
                }],

                // These labels appear in the legend and in the tooltips when hovering different arcs
                labels: [
                    '13 Remaining',
                    '87 Remaining'
                ]
            };
            var options = {
                cutoutPercentage: 0
            };
            var myPieChart = new Chart(ctx, {
                type: 'pie',
                data: data
            });
            var ctxs = document.getElementById('otherPie');
            var datas = {
                datasets: [{
                    data: [75, 25],
                    backgroundColor: [
                        'rgba(153, 255, 190, 1)',
                        'rgba(54, 162, 235, 0.2)'
                    ]
                }],

                // These labels appear in the legend and in the tooltips when hovering different arcs
                labels: [
                    '75% Remaining',
                    '25% Used'
                ]
            };
            var optionss = {
                cutoutPercentage: 0
            };
            var myPieCharts = new Chart(ctxs, {
                type: 'pie',
                data: datas
            });
        </script>

        <script type="text/javascript">
        var myApp = angular.module('drdApp', ['ngAnimate', 'ui.bootstrap']) //, 'ui.select2'])
        myApp.controller("drdController", function ($scope, $location, $http, $filter) {
            $scope.product = {};
            $scope.products = [];
            $scope.productCount = [];
            $scope.paging = [];
            $scope.kriteria = "";
            $scope.page = 1;
            $scope.row = 20;
            $scope.companyOwned = [];
            $scope.currPage = 0;
            $scope.isView = false;
            $scope.index = 0;
            initValues();
            $scope.dashboard = {};
            
            $scope.tags = [];
            $scope.newTag = "";
            $scope.listrotationStatus = [];
            $scope.pagerotationstatus = 1;
            $scope.pagesizerotationstatus = 10;

            $scope.companySelected = {};

            $scope.counter = {
                Old: { Inbox: 0, InProgress: 0, Pending: 0, Declined: 0, Completed: 0, Pending: 0, Altered: 0, Contact: 0, DrDriveDesc: '0GB', Document: 0 },
                New: { Inbox: 0, InProgress: 0, Pending: 0, Declined: 0, Completed: 0, Pending: 0, Altered: 0, Contact: 0, DrDriveDesc: '0GB', Document: 0 }
            };
            $scope.$on("$destroy", function (event) {
                clearInterval(xtimer);
            });
            $scope.notiftime = 5000;
            $scope.xtimer = 0;
            $scope.startCounting = function () {
                $scope.xtimer = setInterval(() => {
                    /*$scope.getActivityCounter();*/
                }, 5000);
            };
            /*--------------------------------------------------------------
            INIT DATA
            --------------------------------------------------------------*/
            function initValues() {
                $scope.dbmenus = @Html.Raw(Json.Encode(Model.dbmenus));
            }
            angular.element(document).ready(function () {
                $scope.getCompanyOwned();
                $scope.getActivityCounter();
                $scope.getDashboardRotationStatus();
                $("#content").show();
            });
            $scope.getActivityCounter = function () {
                $scope.products = [];
                $http.post('@Url.Action("GetActivityCounter", "Dashboard")', {}).then(function (response) {
                    if (response.data) {
                        console.log(response.data);
                        $scope.counter = response.data;
                        var counter = response.data;
                        $.jGrowl.defaults.closer = false;
                        var val = counter.New.Inbox - counter.Old.Inbox;
                        if (val > 0) {
                            $.jGrowl(val + ' item' + (val > 1 ? 's' : '') + ' inbox', {
                                header: 'Inbox Notification',
                                //sticky: true,
                                life: $scope.notiftime,
                                theme: 'alert-styled-right bg-info'
                            });
                        }
                        val = counter.New.InProgress - counter.Old.InProgress;
                        if (val > 0) {
                            $.jGrowl(val + ' item' + (val > 1 ? 's' : '') + ' in progress', {
                                header: 'In Progress Notification',
                                //sticky: true,
                                life: $scope.notiftime,
                                theme: 'alert-styled-right bg-info'
                            });
                        }

                        val = counter.New.Signed - counter.Old.Signed;
                        if (val > 0) {
                            $.jGrowl(val + ' item' + (val > 1 ? 's' : '') + ' signed', {
                                header: 'Signed Notification',
                                //sticky: true,
                                life: $scope.notiftime,
                                theme: 'alert-styled-right bg-info'
                            });
                        }
                        val = counter.New.Declined - counter.Old.Declined;
                        if (val > 0) {
                            $.jGrowl(val + ' item' + (val > 1 ? 's' : '') + ' declined', {
                                header: 'Declined Notification',
                                //sticky: true,
                                life: $scope.notiftime,
                                theme: 'alert-styled-right bg-danger'
                            });
                        }
                        val = counter.New.Completed - counter.Old.Completed;
                        if (val > 0) {
                            $.jGrowl(val + ' item' + (val > 1 ? 's' : '') + ' completed', {
                                header: 'Completed Notification',
                                //sticky: true,
                                life: $scope.notiftime,
                                theme: 'alert-styled-right bg-info'
                            });
                        }
                        val = counter.New.Altered - counter.Old.Altered;
                        if (val > 0) {
                            $.jGrowl(val + ' item' + (val > 1 ? 's' : '') + ' altered', {
                                header: 'Altered Notification',
                                //sticky: true,
                                life: $scope.notiftime,
                                theme: 'alert-styled-right bg-info'
                            });
                        }
                        val = counter.New.Revised - counter.Old.Revised;
                        if (val > 0) {
                            $.jGrowl(val + ' item' + (val > 1 ? 's' : '') + ' revised', {
                                header: 'Revised Notification',
                                //sticky: true,
                                life: $scope.notiftime,
                                theme: 'alert-styled-right bg-info'
                            });
                        }
                        if (counter.New.DepositBalance != counter.Old.DepositBalance) {
                            $.jGrowl("DRD Point " + $filter('number')(counter.New.DepositBalance, 0), {
                                header: 'DRD Point ',
                                //sticky: true,
                                life: $scope.notiftime,
                                theme: 'alert-styled-right bg-success-400'
                            });
                        }
                    }
                    else {
                        clearInterval($scope.xtimer);
                        swal({
                            title: "Session expired!",
                            text: "The session has expired, the page will redirect to login. I will close in 10 seconds.",
                            confirmButtonColor: "#2196F3",
                            timer: 10000
                        }, function () {
                            swal.close();
                            location.href = "/Login";
                        });
                    }
                }, function (response) {
                    //error handle\
                    var x = 0;
                });
            }
            $scope.getCompanyOwned = function () {
                $http.post('@Url.Action("GetAllCompanyOwnedbyUser", "Company")', {}).then(function (response) {
                    console.log("run");
                    if (response.data) {
                        $scope.companyOwned = response.data.companies;
                        console.log($scope.companyOwned);
                    }
                })
            }
            /*--------------------------------------------------------------
            CONVERT JSON DATE
            --------------------------------------------------------------*/
            $scope.convertJsonDate = function (val) {
                if (val == undefined)
                    return '';
                return new Date(parseInt(val.substr(6)));
            }
            /*--------------------------------------------------------------
            TAGGING SYSTEM FILTER
            --------------------------------------------------------------*/
            $scope.addTagList = function () {
                $scope.newTag = $scope.newTag.substring(0, $scope.newTag.length - 1);
                var alreadyUsed = false;
                $scope.tags.some(function (element, i) {
                    if ($scope.newTag.toLowerCase() === element.toLowerCase()) {
                        alreadyUsed = true;
                        return;
                    }
                })
                if (!alreadyUsed) {
                    $scope.tags.push($scope.newTag);
                }
                $scope.newTag = "";
                $scope.getDashboardRotationStatus();
            }
            $scope.removeTag = function (index) {
                $scope.tags.splice(index, 1);
            }
            /*--------------------------------------------------------------
            Dashboard Rotation Status
            --------------------------------------------------------------*/
            $scope.getDashboardRotationStatus = function () {
                console.log($scope.companyOwned[$scope.companySelected]);
                $http.post('@Url.Action("GetDashboardRotationStatus", "Dashboard")',
                    { companyId: -1, Tags: $scope.tags, page: $scope.pagerotationstatus, pageSize: $scope.pagesizerotationstatus }
                ).then(function (response) {
                    if (response.data) {
                        $scope.listrotationStatus = response.data;
                        return true;
                    }
                    else {
                        return false;
                    }
                }, function (response) {
                    //error handle\
                        var x = 0;
                        return false;
                });
            }
            $scope.backRotationStat = function () {
                $scope.pagerotationstatus -= 1;
                if (!$scope.getDashboardRotationStatus()) {
                    $scope.pagerotationstatus += 1;
                    window.alert("This is the first page");
                }
            }
            $scope.nextRotationStat = function () {
                $scope.pagerotationstatus += 1;
                if (!$scope.getDashboardRotationStatus()) {
                    $scope.pagerotationstatus -= 1;
                    window.alert("This is the last page");
                }
            }
            /*--------------------------------------------------------------
            CSV Handling
            --------------------------------------------------------------*/
            $scope.convertToCSV = function (objArray) {
                var array = typeof objArray !== 'object' ? JSON.parse(objArray) : objArray;
                var str = '';
                for (var i = 0; i < array.length; i++) {
                    var line = '';
                    for (var index in array[i]) {
                        if (line != '') {line += ',';}
                        if (typeof array[i][index] === 'object') {
                            var penggantiobj = array[i][index];
                            for (var index2 in penggantiobj) {
                                line += penggantiobj[index2];
                            }
                        } else {
                            line += array[i][index];
                        }
                    }
                    str += line + '\r\n';
                }
                return str;
            }
            $scope.exportCSVFile = function (headers, items, fileTitle) {
                if (headers) {
                    items.unshift(headers);
                }

                // Convert Object to JSON
                var jsonObject = JSON.stringify(items);

                var csv = $scope.convertToCSV(jsonObject);

                var exportedFilename = fileTitle + '.csv' || 'export.csv';

                var blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                if (navigator.msSaveBlob) { // IE 10+
                    navigator.msSaveBlob(blob, exportedFilename);
                } else {
                    var link = document.createElement("a");
                    if (link.download !== undefined) { // feature detection
                        // Browsers that support HTML5 download attribute
                        var url = URL.createObjectURL(blob);
                        link.setAttribute("href", url);
                        link.setAttribute("download", exportedFilename);
                        link.style.visibility = 'hidden';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    }
                }
            }
            $scope.exportRotationListToCSV = function () {
                var filename = $scope.tags.toString() + $scope.companySelected.Name;
                $scope.exportCSVFile(null, $scope.listrotationStatus, filename);
            }

            
            $scope.sendEmailNotifikasiRotasi = function (index) {

                $http.post('@Url.Action("sendEmailNotifikasiRotasi","Dashboard")', {}).then(function (response) {
                    if (response.data) {
                        console.log('send email success')
                    } else {
                        console.log('Filed send email')
                    }
                }, function (response) {
                    console.log("error send email")
                });
            }

            // belum dipake gue rasa
            $scope.linkPage = function (name) {
                var url=$filter('filter')($scope.dbmenus,{SecondaryKey:name})[0].UrlPage;
                location.href=url;
            }
            /*--------------------------------------------------------------
            DO EDIT ROTATION
            --------------------------------------------------------------*/
            $scope.getProductCount = function (kriteria) {
                $http.post('@Url.Action("GetListCount", "Rotation")', { topCriteria: kriteria }).then(function (response) {
                    if (response.data) {
                        var jumlahData = response.data;
                        var jumlahPage = Math.ceil(jumlahData / $scope.row);
                        for (var i = 1; i <= jumlahPage; i++) {
                            $scope.paging.push({ value: i, text: i });
                        }
                        $scope.page = "1";
                    }
                }, function (response) {
                    //error handle\
                    var x = 0;
                });
            }
            
            /*--------------------------------------------------------------
            GENERAL FUNCTION
            --------------------------------------------------------------*/
        });
        $(function () {
        });
        $(document).ready(function () {
        });
        </script>

    </body>