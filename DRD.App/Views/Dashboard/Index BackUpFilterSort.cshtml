@model DRD.Models.View.Layout

@{
    ViewBag.Title = "Dashboard";
    ViewBag.Submenu = "DASHBOARD";
}

@section Scripts
{
    <script src="/assets/js/plugins/buttons/spin.min.js" type="text/javascript"></script>
    <script src="/assets/js/plugins/buttons/ladda.min.js" type="text/javascript"></script>
    <script src="/assets/js/pages/components_buttons.js" type="text/javascript"></script>

    <script src="/assets/vendors/angular-1.5.5/angular.js"></script>
    <script src="/assets/vendors/angular-1.5.5/angular-animate.js"></script>
    <script src="/Scripts/ui-bootstrap-tpls-1.3.2.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>



    <!-- Theme JS files -->
    <script type="text/javascript" src="assets/js/plugins/forms/styling/uniform.min.js"></script>
    <script type="text/javascript" src="assets/js/plugins/visualization/d3/d3.min.js"></script>
    <script type="text/javascript" src="assets/js/plugins/visualization/d3/d3_tooltip.js"></script>
    <!-- /theme JS files -->
 }
@section Styles{ 
    <link href="/assets/css/pages/dashboard.css" rel="stylesheet" type="text/css">
}
    <body ng-controller="drdController">
        <div class="page-container" ng-controller="drdController">
            <section id="dashboard-highlight">
                <div class="row">

                    <!-- DASHBOARD - ROTATION -->
                    <div class="col-sm-12 col-md-6" id="dashboard-rotation">
                        <div class="panel highlight-container">
                            <div class="highlight-card">
                                <!-- HEADER -->
                                <div class="highlight-header">
                                    <div class="container">
                                        <div class="row vertical-align-row">
                                            <div class="col-md-6">
                                                <p class="card-title"><strong>ROTATION</strong></p>
                                            </div>
                                            <div class="col-md-3 push-left">
                                                <!-- SELECT -->
                                                <select class="card-filter">
                                                    <option class="card-filter">This Week</option>
                                                    <option class="card-filter">Last Week</option>
                                                    <option class="card-filter">...</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- CONTENT -->
                                <div class="card-content">
                                    <div class="container">
                                        <div class="row">
                                            <div class="col-sm-6">
                                                <div class="row vertical-align-row" ng-click="linkPage('INPROGRESS')">
                                                    <div class="col-sm-6 vertical-align-content">
                                                        <div class="card-image-lg round-img">
                                                            <img src="~/assets/ongoing.png" />
                                                            <p>Ongoing</p>
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-6">
                                                        <div class="card-content-lg">
                                                            <h1>{{counter.InProgress}}</h1>
                                                        </div>

                                                    </div>

                                                </div>
                                            </div>

                                            <div class="col-sm-6">
                                                <div class="row vertical-align-row" ng-click="linkPage('COMPLETED')">
                                                    <div class="col-sm-6 vertical-align-content">
                                                        <div class="card-image-lg round-img">
                                                            <img src="~/assets/completed.png" />
                                                            <p>Completed</p>
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-6">
                                                        <div class="card-content-lg">
                                                            <h1>{{counter.Completed}}</h1>
                                                        </div>

                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- end of DASHBOARD - ROTATION -->
                    <!-- DASHBOARD - USAGE-->
                    <div class="col-sm-12 col-md-6" id="dashboard-usage">
                        <div class="panel highlight-container">
                            <div class="highlight-card">

                                <!-- HEADER -->
                                <div class="highlight-header">
                                    <div class="container">
                                        <div class="row vertical-align-row">
                                            <div class="col-md-6">
                                                <p class="card-title"><strong>USAGE</strong></p>
                                            </div>
                                            <div class="col-md-3 push-left">
                                                <!-- SELECT -->
                                                <select class="card-filter">
                                                    <option class="card-filter">This Week</option>
                                                    <option class="card-filter">Last Week</option>
                                                    <option class="card-filter">...</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- CONTENT -->
                                <div class="card-content">
                                    <div class="container">
                                        <div class="row vertical-align-row">
                                            <div class="col-sm-5 vertical-align-content">

                                                <canvas id="myChart" width="100" height="100"></canvas>

                                            </div>

                                            <div class="col-sm-5 vertical-align-content">
                                                <div class="card-image-lg">
                                                    <canvas id="otherPie" width="100" height="100"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- end of DASHBOARD - USAGE-->

                </div>
            </section>

            <section id="dashboard-log">

                <div class="panel highlight-container">
                    <div class="highlight-card">
                        <!-- HEADER -->
                        <div class="highlight-header">
                            <div class="container">
                                <div class="row vertical-align-row">
                                    <div class="col-md-6">
                                        <p class="card-title"><strong>LOG</strong></p>
                                    </div>
                                    <div class="col-md-4 push-left">
                                        <!-- SELECT -->
                                        <select class="card-filter select-lg">
                                            <option class="card-filter">PT Company 1</option>
                                            <option class="card-filter">PT Company 2</option>
                                            <option class="card-filter">...</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- FILTER, SORT -->
                        <div class="highlight-header">
                            <div class="container">
                                <div class="row vertical-align-row">
                                    <div class="col-md-4">
                                        <!-- FILTER -->
                                        <p class="sub-card-title">Filter</p>
                                        <div class="select-group">
                                            <span>
                                                <!-- SELECT -->
                                                <select class="card-filter">
                                                    <option class="card-filter">Status</option>
                                                    <option class="card-filter">Ongoing</option>
                                                    <option class="card-filter">...</option>
                                                </select>
                                            </span>

                                            <span>
                                                <!-- SELECT -->
                                                <select class="card-filter">
                                                    <option class="card-filter">Code</option>
                                                    <option class="card-filter">??</option>
                                                    <option class="card-filter">...</option>
                                                </select>
                                            </span>

                                            <span>
                                                <!-- SELECT -->
                                                <select class="card-filter">
                                                    <option class="card-filter">Time</option>
                                                    <option class="card-filter">This Week</option>
                                                    <option class="card-filter">...</option>
                                                </select>
                                            </span>
                                        </div>
                                    </div>

                                    <div class="col-md-4">
                                        <!-- SORT -->
                                        <p class="sub-card-title">Sort</p>
                                        <div class="select-group">
                                            <span>
                                                <!-- SELECT -->
                                                <select class="card-filter">
                                                    <option class="card-filter">Status</option>
                                                    <option class="card-filter">Ongoing</option>
                                                    <option class="card-filter">...</option>
                                                </select>
                                            </span>

                                            <span>
                                                <!-- SELECT -->
                                                <select class="card-filter">
                                                    <option class="card-filter">Subject</option>
                                                    <option class="card-filter">??</option>
                                                    <option class="card-filter">...</option>
                                                </select>
                                            </span>

                                            <span>
                                                <!-- SELECT -->
                                                <select class="card-filter">
                                                    <option class="card-filter">Code</option>
                                                    <option class="card-filter">???</option>
                                                    <option class="card-filter">...</option>
                                                </select>
                                            </span>

                                            <span>
                                                <!-- SELECT -->
                                                <select class="card-filter">
                                                    <option class="card-filter">Workflow</option>
                                                    <option class="card-filter">???</option>
                                                    <option class="card-filter">...</option>
                                                </select>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- CONTENT -->
                        <div class="card-content">
                            <!-- each LOG -->
                            <div class="log container">

                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <div class="card-image">
                                                    <img src="~/assets/ongoing-no-bg.png" />
                                                </div>
                                            </div>
                                            <div class="col-md-9">
                                                <div class="row log-header">
                                                    <span class="border-right">
                                                        <strong>XCD/II/2019</strong>
                                                    </span>
                                                    <span>
                                                        Workflow Apagitu
                                                    </span>
                                                </div>

                                                <p>Permintaan Persetujuan</p>

                                            </div>
                                        </div>

                                    </div>

                                    <div class="col-md-2 text-align-right border-right">
                                        <i>Important Note (Nominal, Due Date, etx.)</i>
                                    </div>
                                    <div class="col-md-4">
                                        <p class="text-light">
                                            Deskripsi...
                                        </p>
                                    </div>
                                    <div class="col-md-2">
                                        <p class="text-align-right"><strong>04.09 PM</strong></p>
                                        <div class="row pull-right">
                                            <span class="card-image-xs round-img">
                                                <img src="~/assets/ongoing-no-bg.png" />
                                            </span>

                                            <span class="card-image-xs round-img">
                                                <img src="~/assets/ongoing-no-bg.png" />
                                            </span>

                                            <span class="card-image-xs round-img">
                                                <img src="~/assets/ongoing-no-bg.png" />
                                            </span>

                                            <span class="card-image-xs round-img">
                                                <img src="~/assets/ongoing-no-bg.png" />
                                            </span>
                                        </div>
                                    </div>
                                </div>


                            </div>

                            <div class="log container">

                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <div class="card-image">
                                                    <img src="~/assets/ongoing-no-bg.png" />
                                                </div>
                                            </div>
                                            <div class="col-md-9">
                                                <div class="row log-header">
                                                    <span class="border-right">
                                                        <strong>XCD/II/2019</strong>
                                                    </span>
                                                    <span>
                                                        Workflow Apagitu
                                                    </span>
                                                </div>

                                                <p>Permintaan Persetujuan</p>

                                            </div>
                                        </div>

                                    </div>

                                    <div class="col-md-2 text-align-right border-right">
                                        <i>Important Note (Nominal, Due Date, etx.)</i>
                                    </div>
                                    <div class="col-md-4">
                                        <p class="text-light">
                                            Deskripsi...
                                        </p>
                                    </div>
                                    <div class="col-md-2">
                                        <p class="text-align-right"><strong>04.09 PM</strong></p>
                                        <div class="row pull-right">
                                            <span class="card-image-xs round-img">
                                                <img src="~/assets/ongoing-no-bg.png" />
                                            </span>

                                            <span class="card-image-xs round-img">
                                                <img src="~/assets/ongoing-no-bg.png" />
                                            </span>

                                            <span class="card-image-xs round-img">
                                                <img src="~/assets/ongoing-no-bg.png" />
                                            </span>

                                            <span class="card-image-xs round-img">
                                                <img src="~/assets/ongoing-no-bg.png" />
                                            </span>
                                        </div>
                                    </div>
                                </div>


                            </div>

                            <div class="log container">

                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <div class="card-image">
                                                    <img src="~/assets/ongoing-no-bg.png" />
                                                </div>
                                            </div>
                                            <div class="col-md-9">
                                                <div class="row log-header">
                                                    <span class="border-right">
                                                        <strong>XCD/II/2019</strong>
                                                    </span>
                                                    <span>
                                                        Workflow Apagitu
                                                    </span>
                                                </div>

                                                <p>Permintaan Persetujuan</p>

                                            </div>
                                        </div>

                                    </div>

                                    <div class="col-md-2 text-align-right border-right">
                                        <i>Important Note (Nominal, Due Date, etx.)</i>
                                    </div>
                                    <div class="col-md-4">
                                        <p class="text-light">
                                            Deskripsi...
                                        </p>
                                    </div>
                                    <div class="col-md-2">
                                        <p class="text-align-right"><strong>04.09 PM</strong></p>
                                        <div class="row pull-right">
                                            <span class="card-image-xs round-img">
                                                <img src="~/assets/ongoing-no-bg.png" />
                                            </span>

                                            <span class="card-image-xs round-img">
                                                <img src="~/assets/ongoing-no-bg.png" />
                                            </span>

                                            <span class="card-image-xs round-img">
                                                <img src="~/assets/ongoing-no-bg.png" />
                                            </span>

                                            <span class="card-image-xs round-img">
                                                <img src="~/assets/ongoing-no-bg.png" />
                                            </span>
                                        </div>
                                    </div>
                                </div>


                            </div>

                        </div>
                    </div>
                </div>

            </section>

            <!-- <button ng-click="sendEmail()">SEND EMAIL</button> -->
        </div>

        <script>
            var ctx = document.getElementById('myChart');
            var data = {
                datasets: [{
                    data: [13, 87],
                    backgroundColor: [
                        'rgba(153, 165, 255, 1)',
                        'rgba(54, 162, 235, 0.2)'
                    ]
                }],

                // These labels appear in the legend and in the tooltips when hovering different arcs
                labels: [
                    '13 Remaining',
                    '87 Remaining'
                ]
            };
            var options = {
                cutoutPercentage: 0
            };
            var myPieChart = new Chart(ctx, {
                type: 'pie',
                data: data
            });



            var ctxs = document.getElementById('otherPie');
            var datas = {
                datasets: [{
                    data: [75, 25],
                    backgroundColor: [
                        'rgba(153, 255, 190, 1)',
                        'rgba(54, 162, 235, 0.2)'
                    ]
                }],

                // These labels appear in the legend and in the tooltips when hovering different arcs
                labels: [
                    '75% Remaining',
                    '25% Used'
                ]
            };
            var optionss = {
                cutoutPercentage: 0
            };
            var myPieCharts = new Chart(ctxs, {
                type: 'pie',
                data: datas
            });
        </script>

        <script type="text/javascript">
        var myApp = angular.module('drdApp', ['ngAnimate', 'ui.bootstrap']) //, 'ui.select2'])
        myApp.controller("drdController", function ($scope, $location, $http, $filter) {
            $scope.product = {};
            $scope.products = [];
            $scope.productCount = [];
            $scope.paging = [];
            $scope.kriteria = "";
            $scope.page = 1;
            $scope.row = 20;
            $scope.currPage = 0;
            $scope.isView = false;
            $scope.index = 0;
            initValues();
            $scope.dashboard = {};
            $scope.$on("$destroy", function (event) {
                clearInterval(xtimer);
            });
            $scope.counter = { Inbox: 0, InProgress: 0, Pending: 0, Declined:0, Completed:0, Pending:0, Altered:0, Contact:0, DrDriveDesc:'0GB',Document:0 };
            $scope.notiftime = 5000;
            $scope.xtimer = 0;
            $scope.startCounting = function () {
                $scope.xtimer = setInterval(() => {
                    /*$scope.getActivityCounter();*/
                }, 5000);
            };
            /*--------------------------------------------------------------
            INIT DATA
            --------------------------------------------------------------*/
            function initValues() {
                $scope.dbmenus = @Html.Raw(Json.Encode(Model.dbmenus));
            }
            angular.element(document).ready(function () {
                $scope.startCounting();
                $scope.getActivityCounter();
                $("#content").show();

            });
            $scope.getActivityCounter = function () {
                $http.post('@Url.Action("GetActivityCounter", "Dashboard")', {}).then(function (response) {
                    if (response.data) {
                        $scope.counter = response.data.New;
                    }
                    else {
                    }
                }, function (response) {
                    //error handle\
                    var x = 0;
                });
            }
            $scope.resetCounter = function () {
                $scope.counter.InProgress = 0;
                $scope.counter.Completed = 0;

            }
            $scope.linkPage = function (name) {
                var url=$filter('filter')($scope.dbmenus,{SecondaryKey:name})[0].UrlPage;
                location.href=url;
            }
            /*--------------------------------------------------------------
            DO EDIT ROTATION
            --------------------------------------------------------------*/


            $scope.getProductCount = function (kriteria) {
                $http.post('@Url.Action("GetListCount", "Rotation")', { topCriteria: kriteria }).then(function (response) {
                    if (response.data) {
                        var jumlahData = response.data;
                        var jumlahPage = Math.ceil(jumlahData / $scope.row);
                        for (var i = 1; i <= jumlahPage; i++) {
                            $scope.paging.push({ value: i, text: i });
                        }
                        $scope.page = "1";
                    }
                }, function (response) {
                    //error handle\
                    var x = 0;
                });
            }
             // $scope.sendEmail = function () {
            //     $http.post('@Url.Action("SendEmail","Dashboard")', {}).then(function (response) {
            //         if (response.data) {
            //             console.log('send email success')
            //         } else {
            //             console.log('Filed send email')
            //         }
            //     }, function (response) {
            //         console.log("error send email")
            //     });
            // }
            
            /*--------------------------------------------------------------
            GENERAL FUNCTION
            --------------------------------------------------------------*/
            /*--------------------------------------------------------------
            CONVERT JSON DATE
            --------------------------------------------------------------*/
            $scope.convertJsonDate = function (val) {
                if (val == undefined)
                    return '';
                return new Date(parseInt(val.substr(6)));
            }
            $scope.sendEmail = function () {
                $http.post('@Url.Action("Sendemail", "dashboard")', {  }).then(function (response) {
                    if (response.data) {
                    }
                }, function (response) {
                    //error handle\
                    var x = 0;
                });
            }
        });
        $(function () {
        });
        $(document).ready(function () {
        });
        </script>

    </body>