@model DRD.Models.View.Layout
@{

}
    <head>
        <meta charset="utf-8" />
        <link href="/Images/logo-color-background.ico" rel="shortcut icon" type="image/x-icon" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="_globalsign-domain-verification" content="EF33yEfW4t6Do605qDtP2Mv2zQVY_oeXy3gkBn9WU7" />

        <title>DRD - @ViewBag.Title</title>

        <!-- Global stylesheets -->
        <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700,900" rel="stylesheet" type="text/css">
        <link href="/assets/css/icons/icomoon/styles.css" rel="stylesheet" type="text/css">
        <link href="/assets/css/bootstrap.css" rel="stylesheet" type="text/css">
        <link href="/assets/css/core.css" rel="stylesheet" type="text/css">
        <link href="/assets/css/components.css" rel="stylesheet" type="text/css">
        <link href="/assets/css/colors.css" rel="stylesheet" type="text/css">
        <link href="/assets/css/pages/layout.css" rel="stylesheet" type="text/css">
        <link href="~/assets/css/pages/for-all-page.css" rel="stylesheet" type="text/css">
        <!-- /global stylesheets -->
        <!-- /Custom Stylesheet-->
        @RenderSection("Styles", false/*required*/)
        <!-- /Custom Stylesheet-->
        <!-- spinner on button-->
        <script src="/assets/js/plugins/buttons/spin.min.js" type="text/javascript"></script>

        <script src="/assets/js/plugins/buttons/ladda.min.js" type="text/javascript"></script>
        <script type="text/javascript" src="~/assets/js/constant.js"></script>
        <!-- Core JS files -->
        <script type="text/javascript" src="~/assets/js/core/libraries/jquery.min.js"></script>
        <script type="text/javascript" src="~/assets/js/core/libraries/bootstrap.min.js"></script>
        <script type="text/javascript" src="~/assets/js/core/moment.js"></script>
        <!-- /core JS files -->
        <!-- Theme JS files -->
        <script type="text/javascript" src="~/assets/js/plugins/ui/nicescroll.min.js"></script>
        <script type="text/javascript" src="~/assets/js/core/app.js"></script>
        <script type="text/javascript" src="~/assets/js/pages/layout_fixed_custom.js"></script>
        <script type="text/javascript" src="~/assets/js/plugins/ui/ripple.min.js"></script>
        <!-- /theme JS files -->
        <!-- Theme JS files -->
        <script type="text/javascript" src="~/assets/js/plugins/notifications/noty.min.js"></script>
        <script type="text/javascript" src="~/assets/js/plugins/notifications/jgrowl.min.js"></script>
        <script type="text/javascript" src="~/assets/js/plugins/notifications/bootbox.min.js"></script>
        <script type="text/javascript" src="~/assets/js/plugins/notifications/sweet_alert.min.js"></script>
        <script type="text/javascript" src="~/assets/js/nprogress.js"></script>
        <script src="~/Scripts/xpublic.js"></script>
        <!-- /theme JS files -->
        <script src="~/assets/vendors/angular-1.5.5/angular.js"></script>
        <script src="~/assets/vendors/angular-1.5.5/angular-animate.js"></script>
        <script src="~/Scripts/ui-bootstrap-tpls-1.3.2.js"></script>

        <!-- /Custom JS-->

        @RenderSection("Scripts", false/*required*/)
        <!-- /Custom JS-->
    </head>

<body class="navbar-top" ng-app="drdApp">
    <div ng-controller="drdControllerMain">
        <!-- Main navbar -->
        <div class="navbar navbar-default navbar-fixed-top header-highlight">
            <div class="navbar-header" style="background-color:black">
                <a class="navbar-brand" href="/" style="color:white">
                    <img ng-show="!loadMenu" ng-src="/Images/logo-color-background.png" alt="">
                </a>
                <ul class="nav navbar-nav visible-xs-block">
                    <li>
                        <a style="border-radius:50%" data-toggle="collapse" data-target="#navbar-mobile"> <img style="width:20px;height:20px;" src="@(Model.User.ProfileImageFileName!=null ? "/Images/Member/"+Model.User.EncryptedId+"/" + Model.User.ProfileImageFileName : "/Images/Member/blue-user-icon-32.jpg")" alt="" /></a>
                    </li>
                    <li>
                        <a class="sidebar-mobile-main-toggle"><i class="icon-paragraph-justify3"></i></a>
                    </li>
                </ul>
            </div>
            <div class="navbar-collapse collapse" id="navbar-mobile">
                <ul class="nav navbar-nav">
                    <li>
                        <a class="sidebar-control sidebar-main-toggle hidden-xs"><i class="icon-paragraph-justify3" style="top:3px"></i></a>
                    </li>
                    <li>
                        <a href="/">
                        </a>
                    </li>
                </ul>
                <div class="navbar-right">
                    <ul class="nav navbar-nav">
                        <li>
                            <a href="/chat/chat">
                                <i class="icon-bell2" style="top:3px"></i>
                                <span class="visible-xs-inline-block position-right">Chat</span>
                                <span class="badge bg-warning-400" style="display:none" ng-show="counter.UnReadChat>0">{{counter.UnReadChat}}</span>
                            </a>
                        </li>
                        <li class="dropdown">
                            <a class="dropdown-toggle" data-toggle="dropdown">
                                <img src="@(Model.User.ProfileImageFileName!=null ? "/Images/Member/" + Model.User.EncryptedId+"/"+Model.User.ProfileImageFileName : "/Images/Member/blue-user-icon-32.jpg")" alt="" />
                                <span> @Model.User.FirstName </span>
                                <i class="caret"></i>
                            </a>
                            <ul id="mobile-view" class="dropdown-menu dropdown-menu-right">
                                <li>
                                    <a href="/profile"><i class="icon-user"></i> <span>Profile</span></a>
                                </li>
                                <li>
                                    <a href="/setting"><i class="icon-gear"></i> <span>Setting</span></a>
                                </li>
                                <li>
                                    <a href="/Login/ChangePassword"><i class="icon-lock5"></i> <span>Change Password</span></a>
                                </li>
                                <li class="divider"></li>
                                <li>
                                    <a href="/Login/Logout"><i class="icon-switch2"></i> <span>Logout</span></a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- /main navbar -->
        <!-- Page container -->
        <div class="page-container">
            <!-- Page content -->
            <div class="page-content">
                <!-- Main sidebar -->
                <div class="sidebar sidebar-main sidebar-fixed" style="background-color: black">
                    <div class="sidebar-content">
                        <!-- User menu -->
                        <span><img ng-show="loadMenu" style="position:absolute; left:50%;top: 50%;width:100px;transform: translate(-50%, -50%); height:50px;" src="~/assets/spinner2.gif"></span>

                        <div class="sidebar-user-material">
                            <div class="category-content desktop_layout">
                            </div>
                        </div>

                        <!-- /user menu -->
                        <!-- Main navigation -->
                        <div class="sidebar-category sidebar-category-visible">
                            <div class="category-content no-padding" id="menu-content">
                                <ul class="navigation navigation-main navigation-accordion">
                                    <!-- Main -->
                                    <li ng-repeat="x in menusFromController" ng-show="!loadMenu" class="{{x.Code == 0 ? 'divider' : (x.SecondaryKey == viewbagsubmenu ? 'active':'')}}" style="{{x.code==0?'height:1px;padding:5px':''}}">
                                        <a ng-show="x.Code!=0" href="{{x.UrlPage}}"><i class="{{x.Icon}}"></i> <span>{{x.Name }} </span></a>
                                        <div ng-show="x.Code==0" style=" border-top: 1px groove #b5b5b5;width: 90%;height:1px;margin: auto;"></div>
                                    </li>
                                    <!-- /main -->
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /main sidebar -->
                <!-- Main content -->
                <div class="content-wrapper">
                    <!-- Content area -->
                    <div class="content">
                        @RenderBody()
                    </div>
                    <!-- /content area -->
                </div>
                <!-- /main content -->
            </div>
            <!-- /page content -->
        </div>
        <!-- /page container -->
    </div>
</body>

@RenderSection("ScriptsBottom", false/*required*/)
<script type="text/javascript">

    //var myApp = angular.module('drdApp', ['ngAnimate', 'ui.bootstrap'])
    myApp.controller("drdControllerMain", function ($scope, $location, $http, $filter) {

        $scope.$on("$destroy", function (event) {
            clearInterval(xtimer);
        });
        $scope.inboxCounter = {
            Old: { Read: 0, UnRead: 0},
            New: { Read: 0, UnRead: 0}
        }
        $scope.notiftime = 5000;
        $scope.xtimer = 0;

        $scope.menusFromController = "";

        $scope.loadMenu = true;

        /*--------------------------------------------------------------
        INIT DATA
        --------------------------------------------------------------*/
        angular.element(document).ready(function () {
            $scope.menusFromController = @Html.Raw(Json.Encode(Model.Menus));
            $scope.viewbagsubmenu = @Html.Raw(Json.Encode(ViewBag.Submenu));
            NProgress.done();
            $("#menu-content").show();
            $scope.getUnreadInbox();
        });

        /*--------------------------------------------------------------
        GET ASSET ITEM
        ------------------------------------- -------------------------*/

        $scope.getUnreadInbox = function () {
            $http.post('@Url.Action("UpdateUnreadInboxCounter", "Inbox")', {}).then(function (response) {
                if (response.data) {
                    $scope.inboxCounter = response.data;
                    if ($scope.inboxCounter.New.Unread > 0) {
                        $(".sidebar-inbox").parent().append("<span data-toggle=\"tooltip\" title=\"unread\" data-placement=\"bottom\" class=\"badge badge-danger\">" + $scope.inboxCounter.New.Unread + "</span>");
                    }
                    $scope.loadMenu = false;
                }
                else {
                    $scope.loadMenu = false;
                }
            }, function (response) {
                //error handle\
                    var x = 0;
                    $scope.loadMenu = false;
            });
        }

        moment.calendarFormat = function (myMoment, now) {
            var diff = myMoment.diff(now, 'days', true);
            var thisYear = myMoment.year() === now.year();
            var beforeYear = myMoment.year() < now.year();

            console.log(thisYear +" "+ diff);

            var retVal =
                beforeYear? 'sameElse':
                diff < -6 && thisYear ? 'thisYear' :
                diff < -1 ? 'lastWeek' :
                diff < 0 ? 'lastDay' :
                diff < 1 ? 'sameDay' :
                diff < 2 ? 'nextDay' :
                                diff < 7 ? 'nextWeek' : 'sameElse';
            console.log(retVal);
            return retVal;
        };

        $scope.getDateFormated = function  (date, format){
            var dafaultOnlyTime = 'HH:mm';
            var defaultOnlyDate = 'DD/MM/YYYY';
            var defaultDateTime = 'DD/MM/YYYY HH:mm'

            var dateDefault = format == 0 ? defaultOnlyTime : format == 1 ? defaultOnlyDate : defaultDateTime;
            return moment(date).calendar(null,{
               sameDay: 'H:mm',
               lastDay: '[yesterday]',
               lastWeek: 'DD/MM',
                thisYear: 'DD/MM',
                sameElse: dateDefault
           });
        }

        $scope.convertJsonDate = function (val) {
                if (val == undefined)
                    return null;
                if (val instanceof Date)
                    return val;
                return new Date(parseInt(val.substr(6)));
        };

        $(window).load(function () {
            NProgress.done();
        });

        /*--------------------------------------------------------------
        JS
        --------------------------------------------------------------*/
    });
</script>